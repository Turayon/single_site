---
title: 超高性价比dpdk-box攒机
date: 2024-01-22 20:04:36
tags:
- 草稿
- network
- dpdk
---

淦刚打算完全放弃dpdk就食言了，公司想要搞个新品种负载均衡，那就先整个软路由回去试试咯。

## 收集到的信息
### 主板
最具**性价比**的几张卡，超微h11ssl-i，超微h11dsi，都是epyc 7001/7002平台的。h11ssl-i大概1k5左右吧。
h11ssl-i是单u主板，pcie插槽：3*pcie3.0x16+3*pcie3.0x8
h11dsi  是双u主板，pcie插槽：2*pcie3.0x16+3*pcie3.0x8
永擎epyc-d8单u主板，pcie插槽：4*pcie3.0x16+3*pcie3.0x8，双m.2
h11ssl-nc，带一个SAS

### cpu
epyc7261，8c16t，*很牛逼，带100G肯定没问题。200块左右。*
### 网卡
经典HP544+FLR，60块左右，算上转接卡80。占用通道：pcie3.0x8。这款网卡的芯片在dpdk那里的别名是nvidia的**mlx4**，而不是mlx3。
~~!!!!!!太坑了，刚开始以为芯片叫CX3PRO，所以不应该是mlx3嘛。~~
### 内存
支持ddr4 3200，但是插的内存少的话，插哪条插槽有讲究，见[](https://www.pcserver.cn/h-nd-86.html)
### 硬盘
两个主板都是板载**一个**pcie3.0x4的m.2槽。很明显了，用这个装系统。

## 合理的攒机方案
### 内存
4根8G-ddr4 3200
### 网络
带**两块**hp544+flr
### cpu
7261
### 主板
h11ssl-i

## 刚解决的问题
### pcie控制器的真实实力
128条pcie3.0可以同时拉满。一条pcie3.0x16大概是上下总共16GByte/s，一条pcie4.0x16大概是上下总共64GByte/s，所以说，epyc二代支持pcie4.0x16就完全足够战未来了。128条总实力大概是上下总共128GByte左右。
### 100G网卡多少钱
CX455A方案，使用dpdk的lib-mlx5驱动，550~650左右，pcie3.0x16接口，一般是半高卡

## 尚未解决的问题
### 为了避免cpu成为瓶颈，软件上要适应哪些amd特性？
？？？
### 假设要带6张卡，240G流量，CPU能顶住嘛？需要哪款CPU？
或者120G就是pcie控制器的瓶颈，那么应该用哪款U？
### 多插几块网卡的话，能不能做LACP聚合成超级链路？
同一网卡上的两个SFP接口能不能聚合？不同网卡上的SFP接口能不能跨网卡聚合？能不能跨好几个网卡聚合？