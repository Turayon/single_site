---
title: CA体制，以及crt文件/key文件
date: 2024-01-19 17:21:52
tags:
---

首先要明确，在CA体制下只存在两种文件：

- crt文件：存储证书、公钥，可以给别人看
- key文件：存储私钥，不能给别人看，除了CA


为什么私钥可以给CA看呢？因为CA想派人伪装你，有一万种方法，不需要通过记你的私钥

## CA体制中的角色
CA体制中，有一名CA和许多名用户，CA服务于其他所有人

## 各文件的来源
- ca.key：CA的私钥，由CA自行生成
- ca.crt：CA的公钥（证书），由CA根据ca.key生成
- user.key：用户的私钥，由用户自行生成
- user.crt：用户的，带CA签名的公钥（证书），用户向CA展示私钥后由CA颁发给用户

## 文件持有状态
### 私钥文件
每个人（包括CA），各自持有自己的私钥
### 公钥（证书）文件
CA只持有CA自己的证书
其他用户不仅持有自己的证书，并且还持有CA的证书（因为需要用CA的证书验证其他人身份，而不能验证的时候再临时从CA处获取）

## CA验证流程
仅以user.A访问user.B作为例子
### B可以接受任何人访问，但是A要确认B的身份(https)
- 第一步，通过CA的crt证书，确认B的crt证书真实性
- 第二步，准备好要发送的信息，将信息通过B的公钥加密，发送给B
- 第三步，B用私钥解密收到的信息，并且结合该信息进行回复（通常信息中会有随机数需要直接回复），以此证明自己的身份
### B要确认A的身份，且也要确认B的身份(openvpn)
- 第一步，互相展示crt证书并验证对方证书真实性
- 第二步，互相发送用公钥加密的数据包
- 第三步，收到对方的加密数据包后，解密并通过对方公钥加密，再次发送（自证数据包）
- 第四步，各自收到对方的自证数据包，对比之前发送的数据，如果一样就完成验证


